<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ykt.backstage.dao.CardTransactionsMapper">
    <cache type="com.ykt.backstage.common.config.MybatisRedisCache">
        <property name="eviction" value="LRU"/>
        <property name="flushInterval" value="6000000"/>
        <property name="size" value="1024"/>
        <property name="readOnly" value="false"/>
    </cache>
    <resultMap id="BaseResultMap" type="com.ykt.backstage.entity.CardTransactions">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="transaction_id" jdbcType="BIGINT" property="transactionId"/>
        <result column="transaction_date" jdbcType="CHAR" property="transactionDate"/>
        <result column="transaction_time" jdbcType="TIMESTAMP" property="transactionTime"/>
        <result column="transaction_amount" jdbcType="INTEGER" property="transactionAmount"/>
        <result column="transaction_type" jdbcType="CHAR" property="transactionType"/>
        <result column="transaction_status" jdbcType="INTEGER" property="transactionStatus"/>
        <result column="merchant_code" jdbcType="VARCHAR" property="merchantCode"/>
        <result column="sno" jdbcType="VARCHAR" property="sno"/>
        <result column="card_account_num" jdbcType="VARCHAR" property="cardAccountNum"/>
        <result column="created_at" jdbcType="TIMESTAMP" property="createdAt"/>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from card_transactions
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.ykt.backstage.entity.CardTransactions">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into card_transactions (transaction_id, transaction_date, transaction_time,
        transaction_amount, transaction_type, transaction_status,
        merchant_code, sno, card_account_num,
        created_at)
        values (#{transactionId,jdbcType=BIGINT}, #{transactionDate,jdbcType=CHAR},
        #{transactionTime,jdbcType=TIMESTAMP},
        #{transactionAmount,jdbcType=INTEGER}, #{transactionType,jdbcType=CHAR}, #{transactionStatus,jdbcType=INTEGER},
        #{merchantCode,jdbcType=VARCHAR}, #{sno,jdbcType=VARCHAR}, #{cardAccountNum,jdbcType=VARCHAR},
        #{createdAt,jdbcType=TIMESTAMP})
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.ykt.backstage.entity.CardTransactions">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update card_transactions
        set transaction_id = #{transactionId,jdbcType=BIGINT},
        transaction_date = #{transactionDate,jdbcType=CHAR},
        transaction_time = #{transactionTime,jdbcType=TIMESTAMP},
        transaction_amount = #{transactionAmount,jdbcType=INTEGER},
        transaction_type = #{transactionType,jdbcType=CHAR},
        transaction_status = #{transactionStatus,jdbcType=INTEGER},
        merchant_code = #{merchantCode,jdbcType=VARCHAR},
        sno = #{sno,jdbcType=VARCHAR},
        card_account_num = #{cardAccountNum,jdbcType=VARCHAR},
        created_at = #{createdAt,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=INTEGER}
    </update>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select id, transaction_id, transaction_date, transaction_time, transaction_amount,
        transaction_type, transaction_status, merchant_code, sno, card_account_num, created_at
        from card_transactions
        where id = #{id,jdbcType=INTEGER}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select id, transaction_id, transaction_date, transaction_time, transaction_amount,
        transaction_type, transaction_status, merchant_code, sno, card_account_num, created_at
        from card_transactions
    </select>

    <!-- 分页查询 -->
    <select id="pageQuery" resultMap="BaseResultMap">
        select *
        from card_transactions
        <bind name="offset" value="(query.pn-1)*query.ps"></bind>
        limit #{offset},#{query.ps}
    </select>

    <!-- 查询一个月的数据 -->
    <select id="selectMonth" resultMap="BaseResultMap">
        select *
        from card_transactions where DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= date(transaction_time)
    </select>

    <!-- 查询一年的数据 -->
    <select id="selectYear" resultMap="BaseResultMap">
        select *
        from card_transactions where transaction_time between date_sub(now(),interval 12 month) and now();
    </select>

    <!-- 查询一个月分类，分日期的数据 -->
    <select id="selectMonthByTypeDate" resultType="com.ykt.backstage.VO.CardTransactionsVO">
        select transaction_type,transaction_date,SUM(transaction_amount)
        from card_transactions where DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= date(transaction_time) group by
        transaction_type,transaction_date
    </select>

    <!-- 根据传入时间和类型来返回该条件下的具体消费情况 -->
    <select id="selectByDateType" resultMap="BaseResultMap">
        select *
        from card_transactions where transaction_date = #{time} and transaction_type = #{type}
    </select>

    <!-- 返回该生的消费top10数据 -->
    <select id="getTop10" resultType="com.ykt.backstage.VO.CardTransactionsVO">
        select transaction_type,transaction_date,transaction_amount from card_transactions order by transaction_amount
        DESC limit 10
    </select>
</mapper>